<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cursos - CEFORSEG</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-4">

  <a href="dashboard.html"><button>Salir</button></a>
  <h3>ðŸ“š GestiÃ³n de Cursos</h3>

  <div class="card mb-3">
    <div class="card-body">
      <input id="nombre" class="form-control mb-2" placeholder="Nombre del curso">
      <textarea id="descripcion" class="form-control mb-2" placeholder="DescripciÃ³n"></textarea>
      <input id="precio" type="number" class="form-control mb-2" placeholder="Precio">
      <button class="btn btn-primary w-100" onclick="crear()">Guardar</button>
    </div>
  </div>

  <table class="table table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Nombre</th>
        <th>Precio</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="tabla"></tbody>
  </table>
</div>

<script>
const token = localStorage.getItem('token');
if (!token) location.href = '/login';

async function cargar() {
  const res = await fetch('/api/cursos', {
    headers: { Authorization: 'Bearer ' + token }
  });
  const data = await res.json();
  tabla.innerHTML = '';
  data.forEach(c => {
    tabla.innerHTML += `
      <tr>
        <td>${c.nombre}</td>
        <td>$${c.precio}</td>
        <td>
          <button class="btn btn-danger btn-sm" onclick="eliminar(${c.id})">Eliminar</button>
        </td>
      </tr>
    `;
  });
}

async function crear() {
  await fetch('/api/cursos', {
    method: 'POST',
    headers: {
      'Content-Type':'application/json',
      'Authorization':'Bearer ' + token
    },
    body: JSON.stringify({
      nombre: nombre.value,
      descripcion: descripcion.value,
      precio: precio.value
    })
  });
  cargar();
}

async function eliminar(id) {
  await fetch('/api/cursos/' + id, {
    method: 'DELETE',
    headers: { Authorization: 'Bearer ' + token }
  });
  cargar();
}

cargar();
</script>

</body>
</html>

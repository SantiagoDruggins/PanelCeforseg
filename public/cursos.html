<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cursos - CEFORSEG</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<script>
if(!localStorage.getItem('token')){
  location.href='/login';
}
</script>

<div id="app"></div>

<script>
const token = localStorage.getItem('token');

fetch('/layout.html')
  .then(r => r.text())
  .then(html => {
    document.getElementById('app').innerHTML = html;
    const content = document.querySelector('.content');

    content.innerHTML = `
      <h3 class="mb-4">ðŸ“š GestiÃ³n de Cursos</h3>

      <div class="card mb-4 shadow-sm">
        <div class="card-body">
          <div class="row g-2">
            <div class="col-md-4">
              <input id="nombre" class="form-control" placeholder="Nombre del curso" required>
            </div>
            <div class="col-md-4">
              <input id="precio" type="number" class="form-control" placeholder="Precio" required>
            </div>
            <div class="col-md-4">
              <input id="descripcion" class="form-control" placeholder="DescripciÃ³n del curso" required>
            </div>
          </div>
          <button class="btn btn-primary w-100 mt-3" onclick="crearCurso()">
            Guardar curso
          </button>
        </div>
      </div>

      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead class="table-dark">
            <tr>
              <th>Curso</th>
              <th>Precio</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="tablaCursos"></tbody>
        </table>
      </div>
    `;

    cargarCursos();
  });

async function cargarCursos(){
  const res = await fetch('/api/cursos', {
    headers:{ Authorization:'Bearer '+token }
  });
  const data = await res.json();
  const tabla = document.getElementById('tablaCursos');
  tabla.innerHTML = '';

  data.forEach(c => {
    tabla.innerHTML += `
      <tr>
        <td>
          <strong>${c.nombre}</strong><br>
          <small class="text-muted">${c.descripcion || 'Sin descripciÃ³n'}</small>
        </td>
        <td>$${Number(c.precio).toLocaleString()}</td>
        <td>
          <button class="btn btn-danger btn-sm" onclick="eliminarCurso(${c.id})">
            Eliminar
          </button>
        </td>
      </tr>
    `;
  });
}

async function crearCurso(){
  if(!nombre.value || !precio.value || !descripcion.value){
    alert('Todos los campos son obligatorios');
    return;
  }

  await fetch('/api/cursos', {
    method:'POST',
    headers:{
      'Content-Type':'application/json',
      'Authorization':'Bearer '+token
    },
    body: JSON.stringify({
      nombre: nombre.value,
      descripcion: descripcion.value,
      precio: precio.value
    })
  });

  nombre.value = '';
  descripcion.value = '';
  precio.value = '';
  cargarCursos();
}

async function eliminarCurso(id){
  if(!confirm('Â¿Eliminar este curso?')) return;

  await fetch('/api/cursos/'+id, {
    method:'DELETE',
    headers:{ Authorization:'Bearer '+token }
  });
  cargarCursos();
}
</script>

</body>
</html>
